<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MyShop.Views.Dashboard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MyShop.Models.Dashboard"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <!-- Added common styles for cards to ensure consistency and clean look -->
        <Style x:Key="DashboardCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
        </Style>

        <Style x:Key="KpiCardStyle" TargetType="Border" BasedOn="{StaticResource DashboardCardStyle}">
            <Setter Property="Padding" Value="24,20"/>
        </Style>
    </Page.Resources>

    <ScrollViewer>
        <Grid Padding="32" RowSpacing="32">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Redesigned Header with icon and subtitle -->
            <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
                <Border Width="48" Height="48" CornerRadius="8" Background="{ThemeResource SystemAccentColor}">
                    <FontIcon Glyph="&#xE9D2;" Foreground="White" FontSize="20"/>
                </Border>
                <StackPanel VerticalAlignment="Center">
                    <TextBlock Text="Cửa hàng của tôi" Style="{ThemeResource TitleLargeTextBlockStyle}" FontWeight="Bold"/>
                    <TextBlock Text="Tổng quan hoạt động kinh doanh trong ngày" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </StackPanel>

            <!-- Refined KPI Cards with Icons and clearer hierarchy -->
            <Grid Grid.Row="1" ColumnSpacing="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Style="{StaticResource KpiCardStyle}">
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <FontIcon Glyph="&#xE7BF;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Tổng sản phẩm" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind ViewModel.TotalProducts, Mode=OneWay}" Style="{ThemeResource TitleTextBlockStyle}" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource KpiCardStyle}">
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <FontIcon Glyph="&#xE8A1;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Đơn hàng hôm nay" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind ViewModel.TodayOrders, Mode=OneWay}" Style="{ThemeResource TitleTextBlockStyle}" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource KpiCardStyle}">
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <FontIcon Glyph="&#xE8C7;" FontSize="28" Foreground="{ThemeResource SystemAccentColor}" VerticalAlignment="Center"/>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Doanh thu hôm nay" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock Text="{x:Bind ViewModel.TodayRevenue, Mode=OneWay}" Style="{ThemeResource TitleTextBlockStyle}" FontWeight="Bold"/>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Added a visual Revenue Chart using pure XAML elements -->
            <Border Grid.Row="2" Style="{StaticResource DashboardCardStyle}">
                <StackPanel Spacing="20">
                    <TextBlock Text="Biểu đồ doanh thu theo ngày" Style="{ThemeResource SubtitleTextBlockStyle}" FontWeight="SemiBold"/>
                    <Grid Height="180">
                        <ItemsControl ItemsSource="{x:Bind ViewModel.MonthlyRevenue, Mode=OneWay}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Bottom" HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="models:RevenueByDay">
                                    <StackPanel Spacing="6" VerticalAlignment="Bottom">
                                        <Rectangle
                                            Width="24"
                                            Height="{x:Bind BarHeight}"
                                            Fill="{ThemeResource SystemAccentColor}"
                                            RadiusX="4"
                                            RadiusY="4"
                                            VerticalAlignment="Bottom"/>
                                        <TextBlock
                                            Text="{x:Bind Day}"
                                            FontSize="10"
                                            HorizontalAlignment="Center"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- Organized data lists into a 3-column layout for better space utilization -->
            <Grid Grid.Row="3" ColumnSpacing="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Border Style="{StaticResource DashboardCardStyle}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE7BA;" FontSize="16" Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                            <TextBlock Text="Sắp hết hàng" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                        <ListView ItemsSource="{x:Bind ViewModel.LowStockProducts, Mode=OneWay}" SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:LowStockProduct">
                                    <TextBlock Text="{x:Bind DisplayText}" Margin="0,4"/>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource DashboardCardStyle}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8A1;" FontSize="16" Foreground="{ThemeResource SystemAccentColor}"/>
                            <TextBlock Text="Bán chạy" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                        <ListView ItemsSource="{x:Bind ViewModel.TopSellingProducts, Mode=OneWay}" SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:TopSellingProduct">
                                    <TextBlock Text="{x:Bind DisplayText}" Margin="0,4"/>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource DashboardCardStyle}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE8A6;" FontSize="16" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                            <TextBlock Text="Đơn hàng gần đây" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                        </StackPanel>
                        <ListView ItemsSource="{x:Bind ViewModel.RecentOrders, Mode=OneWay}" SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="models:RecentOrder">
                                    <TextBlock Text="{x:Bind DisplayText}" Margin="0,4"/>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>
